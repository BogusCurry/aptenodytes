server {

    access_log off;

    listen 443 ssl;

    root /var/www/phpland/web;

    index index.php;

    server_name phpland.org;

    charset utf-8;

    index index.php;

    location ~ /\.(ht|svn|git) { return 404; }

    if ($request_uri ~* \..*\/.*php) { return 404; }

    location ~ /\.ht {
        deny all;
    }

    location ~* \.(jp?g|js|css|png|jpg|jpeg|gif|ico)$ {
        expires max;
        log_not_found off;
    }

    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    location ~ \.php$ {
    	try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
	    fastcgi_index index.php;
	    include fastcgi.conf;
	    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
    }

}

# redirect all requests to HTTPS

server {

    listen 80;

    server_name phpland.org;

    if ($host = phpland.org) {
        return 301 https://$host$request_uri;
    }

}

# redirect all requests to non www

server {

    server_name  www.phpland.org;

    rewrite ^(.*) http://phpland.org$1 permanent;

}
